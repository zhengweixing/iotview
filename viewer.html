<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=5,IE=9" ><![endif]-->
<!DOCTYPE html>
<html>
<head>
    <title>展示</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script type="text/javascript" src="lib/jquery/jquery.js"></script>
    <script type="text/javascript" src="js/Init.js"></script>
    <script type="text/javascript" src="lib/grapheditor/deflate/base64.js"></script>
    <script type="text/javascript" src="lib/grapheditor/sanitizer/sanitizer.min.js"></script>
    <script type="text/javascript" src="lib/mxgraph/src/js/mxClient.js"></script>
    <script type="text/javascript" src="lib/grapheditor/js/Graph.js"></script>
    <script type="text/javascript" src="lib/grapheditor/js/Shapes.js"></script>

    <script type="text/javascript" src="js/App.js"></script>
    <script type="text/javascript" src="js/MyShapes.js"></script>
    <script type="text/javascript" src="js/EChartShapes.js"></script>


    <link rel="stylesheet" type="text/css" href="css/main.css">

    <style type="text/css">
        body{
            margin: 0;
            background-color:#757474;
        }
        #mainBox{
            display: flex;
            position:absolute;
            top:0px;
            bottom:0px;
        }
        #graphContainer{
            margin: auto;
        }
    </style>

</head>
<body onload="main()">
<div id="mainBox">
    <div id="graphContainer"></div>
</div>
<script type="text/javascript">
    var graph, container;
    function show(container, data){
        console.log('viewer show');
        var xmlDoc = mxUtils.parseXml(data);
        var codec = new mxCodec(xmlDoc);
        var model = graph.getModel();
        codec.decode(xmlDoc.documentElement, model);
        var style  = "width:" + model.pageWidth + "px;";
            style += "height:" + model.pageHeight + "px;";
        if(typeof(model.backgroundImage)=="undefined") {
            style += "background:white url(/images/grid.gif)";
        }else{
            style += "background:white url("+model.backgroundImage+")";
            // var image = new mxImage(model.backgroundImage, model.pageWidth, model.pageHeight);
        }
        container.style = style;
        // graph.pageVisible = true;
        // graph.pageFormat = new mxRectangle(0, 0, model.pageWidth, model.pageHeight);
        graph.setBackgroundImage(image);
        graph.view.validateBackground();
        // addZoomBtn();
    }

    function addZoomBtn() {
        var buttons = document.createElement('div');
        buttons.style.position = 'absolute';
        buttons.style.overflow = 'visible';
        var left = 0;
        var bw = 16;
        var bh = 16;
        buttons.style.bottom = 24 + 'px';
        buttons.style.right = bw + bw + 'px';
        if (mxClient.IS_QUIRKS)
        {
            bw -= 1;
            bh -= 1;
        }
        function addButton(label, funct) {
            var btn = document.createElement('div');
            mxUtils.write(btn, label);
            btn.style.position = 'absolute';
            btn.style.backgroundColor = 'transparent';
            btn.style.border = '1px solid gray';
            btn.style.textAlign = 'center';
            btn.style.fontSize = '10px';
            btn.style.cursor = 'pointer';
            btn.style.width = bw + 'px';
            btn.style.height = bh + 'px';
            btn.style.left = left + 'px';
            btn.style.top = '0px';
            mxEvent.addListener(btn, 'click', function(evt)
            {
                funct();
                mxEvent.consume(evt);
            });

            left += bw;
            buttons.appendChild(btn);
        };
        addButton('+', function()
        {
            graph.zoomIn();
        });
        addButton('-', function()
        {
            graph.zoomOut();
        });
        container.appendChild(buttons);
    }

    function main() {
        container = document.getElementById('graphContainer');
        graph = new Graph(container);
        graph.centerZoom = false;
        graph.resizeContainer = false;
        graph.setTooltips(false);
        graph.setEnabled(false);
        graph.isView = true;//设置为浏览模式
        var xml = urlParams.xml;
        if(xml){
            var data = Base64.decode(xml);
            show(container, data);
        }
    };

    window.addEventListener("message", (e) => {
        var data = e.data;
        if(data.type == 'view') {
             var data = data.view;
             show(container, data);
        }
    });
    window.parent.postMessage({ type : 'view', event : 'done' }, "*");
</script>
</body>
</html>
