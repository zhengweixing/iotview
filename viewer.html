<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=5,IE=9" ><![endif]-->
<!DOCTYPE html>
<html>
<head>
    <title>展示</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script type="text/javascript" src="lib/jquery/jquery.js"></script>
    <script type="text/javascript" src="js/Init.js"></script>
    <script type="text/javascript" src="lib/grapheditor/deflate/base64.js"></script>
    <script type="text/javascript" src="lib/grapheditor/sanitizer/sanitizer.min.js"></script>
    <script type="text/javascript" src="lib/mxgraph/src/js/mxClient.js"></script>
    <script type="text/javascript" src="lib/grapheditor/js/Graph.js"></script>
    <script type="text/javascript" src="lib/grapheditor/js/Shapes.js"></script>

    <script type="text/javascript" src="js/App.js"></script>
    <script type="text/javascript" src="js/MyShapes.js"></script>
    <script type="text/javascript" src="js/EChartShapes.js"></script>


    <link rel="stylesheet" type="text/css" href="css/main.css">

    <style type="text/css">
        body{
            margin: 0;
            background-color:#757474;
        }
        #mainBox{
            display: flex;
            position:absolute;
            top:0px;bottom:0px;
            width:100%;
        }
        #graphContainer{
            margin: auto;
            background-color:white;
        }
    </style>

</head>
<body onload="main()">
<div id="mainBox">
    <div id="graphContainer"></div>
</div>
<script type="text/javascript">
    var graph, container;

    function show(container, data){
        console.log('viewer show');
        var xmlDoc = mxUtils.parseXml(data);
        var codec = new mxCodec(xmlDoc);
        var model = graph.getModel();
        codec.decode(xmlDoc.documentElement, model);
        var style  = "width:" + model.pageWidth + "px;";
            style += "height:" + model.pageHeight + "px;";
        if(model.backgroundImage) {
            style += "background:url(" + model.backgroundImage + ") no-repeat top;";
            style += "background-size:" + model.pageWidth + "px " + model.pageHeight + "px;"
        }
        container.style = style;
    }

    function main() {
        container = document.getElementById('graphContainer');
        graph = new Graph(container);
        graph.isView = true;//设置为浏览模式
        graph.resizeContainer = true;
        graph.setEnabled(false);
        var xml = urlParams.xml;
        if(xml){
            var data = Base64.decode(xml);
            show(container, data);
        }
    };

    window.addEventListener("message", (e) => {
        var data = e.data;
        data = JSON.parse(data);
        if(data.type == 'view') {
             var data = data.view;
             show(container, data);
        }
    });
    window.parent.postMessage({ type : 'view', event : 'done' }, "*");
</script>
</body>
</html>
